{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nconst newLine = '\\r\\n';\nconst raf = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : process.nextTick;\nconst makeWrapper = wrapChar => str => `${wrapChar}${str}${wrapChar}`;\nconst makeResolver = (resolve, newLineAtEnd) => content => {\n  if (newLineAtEnd) {\n    content.push('');\n  }\n  resolve(content.join(newLine));\n};\nconst identityMapping = (arr, initialMapping) => arr.reduce((acc, k) => {\n  acc[k] = k;\n  return acc;\n}, initialMapping);\nconst extractHeaderFromData = datas => datas.reduce((acc, v) => Array.isArray(v) ? acc : identityMapping(Object.keys(v), acc), {});\nconst extractHeaderFromColumns = columns => columns.reduce((acc, v) => {\n  var _a;\n  if (typeof v === 'string') {\n    acc[v] = v;\n  } else {\n    acc[v.id] = (_a = v.displayName) !== null && _a !== void 0 ? _a : v.id;\n  }\n  return acc;\n}, {});\nfunction toChunks(arr, chunkSize) {\n  return [...Array(Math.ceil(arr.length / chunkSize))].reduce((acc, _, i) => {\n    const begin = i * chunkSize;\n    return acc.concat([arr.slice(begin, begin + chunkSize)]);\n  }, []);\n}\nconst createChunkProcessor = (resolve, wrap, content, datas, columnOrder, separator, chunkSize) => {\n  const chunks = toChunks(datas, chunkSize);\n  let i = 0;\n  return function processChunk() {\n    if (i >= chunks.length) {\n      resolve(content);\n      return;\n    }\n    const chunk = chunks[i];\n    i += 1;\n    chunk.map(v => Array.isArray(v) ? v : columnOrder.map(k => {\n      var _a;\n      return (_a = v[k]) !== null && _a !== void 0 ? _a : '';\n    })).forEach(v => {\n      content.push(v.map(wrap).join(separator));\n    });\n    raf(processChunk);\n  };\n};\nexport default function csv(_ref) {\n  let {\n    columns,\n    datas,\n    separator = ',',\n    noHeader = false,\n    wrapColumnChar = '',\n    newLineAtEnd = false,\n    chunkSize = 1000\n  } = _ref;\n  return __awaiter(this, void 0, void 0, function* () {\n    // eslint-disable-next-line no-async-promise-executor\n    return new Promise((_resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n      const resolve = makeResolver(_resolve, newLineAtEnd);\n      const wrap = makeWrapper(wrapColumnChar);\n      try {\n        datas = typeof datas === 'function' ? yield datas() : yield datas;\n        if (!Array.isArray(datas)) {\n          return _resolve();\n        }\n        const header = columns ? extractHeaderFromColumns(columns) : extractHeaderFromData(datas);\n        const content = [];\n        if (!noHeader) {\n          const headerNames = Object.values(header);\n          if (headerNames.length > 0) {\n            content.push(headerNames.map(wrap).join(separator));\n          }\n        }\n        const columnOrder = Object.keys(header);\n        const processChunk = createChunkProcessor(resolve, wrap, content, datas, columnOrder, separator, chunkSize);\n        raf(processChunk);\n      } catch (err) {\n        return reject(err);\n      }\n    }));\n  });\n}","map":{"version":3,"mappings":"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","names":["newLine","raf","requestAnimationFrame","process","nextTick","makeWrapper","wrapChar","str","makeResolver","resolve","newLineAtEnd","content","push","join","identityMapping","arr","initialMapping","reduce","acc","k","extractHeaderFromData","datas","v","Array","isArray","Object","keys","extractHeaderFromColumns","columns","id","displayName","toChunks","chunkSize","Math","ceil","length","_","i","begin","concat","slice","createChunkProcessor","wrap","columnOrder","separator","chunks","processChunk","chunk","map","forEach","csv","noHeader","wrapColumnChar","Promise","_resolve","reject","__awaiter","header","headerNames","values","err"],"sourceRoot":"","sources":["../../../src/lib/csv.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}